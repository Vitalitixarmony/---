<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–°–ª–æ–≤–æ –¥–Ω—è ‚Äî –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ (MVP)</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#ffffff;
    --muted:#64748b;
    --accent:#0ea5e9; 
    --good:#10b981;   
    --bad:#ef4444;    
    --yellow:#f59e0b; 
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:
    radial-gradient(circle at 10% 10%, rgba(14,165,233,0.06), transparent 10%),
    linear-gradient(180deg,#f1f5f9 0%, #e6eef8 100%);
    color:var(--bg);-webkit-font-smoothing:antialiased}
  .wrap{max-width:980px;margin:28px auto;padding:18px}
  .header{display:flex;align-items:center;gap:14px;margin-bottom:16px}
  .logo{
    width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#0ea5e9,#06b6d4);
    display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:20px;box-shadow:0 8px 30px rgba(14,165,233,0.12)
  }
  h1{margin:0;font-size:20px}
  p.lead{margin:2px 0 0;color:var(--muted);font-size:14px}
  .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 18px 50px rgba(15,23,42,0.06)}
  .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
  @media (max-width:880px){ .grid{grid-template-columns:1fr;}}
  .panel{padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(250,250,252,0.9));border:1px solid #eef4fb}
  .muted{color:var(--muted);font-size:13px}
  .wordRow{display:flex;align-items:center;gap:12px}
  .word{font-size:28px;font-weight:800}
  .transcr{color:var(--muted);font-weight:600;margin-left:6px}
  .example{margin-top:10px;color:#0f172a}
  .example-trans{margin-top:6px;color:var(--muted);font-size:14px}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  
  .btn {
    border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;
    box-shadow:0 6px 18px rgba(14,165,233,0.08);
  }
  .btn-green{background:var(--good);color:white}
  .btn-accent{background:var(--accent);color:white}
  .btn-yellow{background:var(--yellow);color:white}
  .btn-ghost{background:#eef6fb;color:var(--bg);box-shadow:none;border:1px solid #e6f0f7}
  .smallbtn{background:#f1f5f9;color:var(--bg);padding:6px 10px;border-radius:8px;border:1px solid #e6eef8}
  .btn-red{background:var(--bad);color:white}
  .stats{font-weight:600;margin-top:8px}
  .question{margin:12px 0;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fbfdff,#ffffff);border:1px solid #eef6ff}
  input[type=text]{padding:10px;border-radius:8px;border:1px solid #e6eef8;width:100%;font-size:14px}
  .correct{color:var(--good);font-weight:700}
  .wrong{color:var(--bad);font-weight:700}
  .hint{margin-top:8px;color:var(--muted);font-size:14px}
  .feedback{margin-top:10px;padding:12px;border-radius:8px;background:linear-gradient(90deg, rgba(16,185,129,0.03), rgba(239,68,68,0.02));}
  .opt{padding:8px;border-radius:8px;border:1px solid #eef2ff;margin-top:6px}
  .opt input{margin-right:8px}
  .correct-badge{display:inline-block;padding:6px 8px;background:rgba(16,185,129,0.12);color:var(--good);border-radius:8px;font-weight:700;margin-left:8px}
  .wrong-badge{display:inline-block;padding:6px 8px;background:rgba(239,68,68,0.08);color:var(--bad);border-radius:8px;font-weight:700;margin-left:8px}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  .result-line{margin-top:10px;font-weight:700}
  .highlight-wrong{outline: 3px solid rgba(239,68,68,0.12);border-radius:8px;padding:6px}
  .highlight-correct{outline: 3px solid rgba(16,185,129,0.12);border-radius:8px;padding:6px}
  /* analysis panel */
  #analysisPanel{display:none;margin-top:12px;padding:12px;border-radius:10px;background:#f8fafc;border:1px solid #e6eef8}
  #analysisPanel h4{margin:0 0 8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="logo">EN</div>
    <div>
      <h1>–°–ª–æ–≤–æ –¥–Ω—è ‚Äî –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ </h1>
      <p class="lead">–ö–æ–∂–µ–Ω –¥–µ–Ω—å, –Ω–æ–≤–µ —Å–ª–æ–≤–æ - –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</p>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <div class="panel" id="wordPanel">
          <div class="muted">–°–ª–æ–≤–æ –¥–Ω—è</div>
          <div class="wordRow" style="margin-top:8px">
            <div>
              <div class="word" id="wordText">‚Äî</div>
              <div class="transcr" id="wordTranscr">‚Äî</div>
            </div>
            <div style="margin-left:auto;display:flex;gap:8px;">
              <button id="speakBtn" class="btn btn-accent">üîä –ü–æ—Å–ª—É—Ö–∞—Ç–∏</button>
              <button id="testBtn" class="btn btn-green">‚úÖ –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
            </div>
          </div>

          <div class="example" id="wordExample">‚Äî</div>
          <div class="example-trans" id="wordExampleTrans">‚Äî</div>
          <div class="muted" id="wordTranslation">‚Äî</div>

          <div class="controls">
            
            <button id="repeatBtn" class="btn btn-accent">üîÅ –î–æ–¥–∞—Ç–∏ –≤ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</button>
            
            <button id="showRepeats" class="btn btn-red">üõë –°–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</button>
          </div>
        </div>

        <div id="testArea" style="display:none;margin-top:14px">
          <div class="panel">
            <h3 style="margin:0 0 6px">–¢–µ—Å—Ç ‚Äî 2 –ø–∏—Ç–∞–Ω–Ω—è</h3>
            <div id="questions"></div>
            <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
              <button id="submitTest" class="btn btn-accent">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
              <button id="cancelTest" class="smallbtn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
            <div id="resultArea"></div>
          </div>
        </div>

      </div>

      <div>
        <div class="panel">
          <div class="muted">–¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
          <div class="stats" id="statsBox">
            –¢–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–æ: 0<br>
            % –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: 0%<br>
            –°–ª—ñ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è: 0
          </div>
          <div style="margin-top:12px">
            
            <button id="resetStats" class="btn btn-red">üóëÔ∏è –°–∫–∏–Ω—É—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
          </div>

          
          <div style="margin-top:12px">
            <button id="showAnalysisBtn" class="btn btn-yellow" style="display:none">üîç –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä–æ–∑–±—ñ—Ä</button>
          </div>

          <div style="margin-top:14px" id="repeatsList"></div>
        </div>

        <div style="margin-top:14px" class="panel">
          <div class="muted">–ü–æ—Ä–∞–¥–∞ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</div>
          <ul style="margin:8px 0 0 18px;color:var(--muted)">
            <li>–Ø–∫—â–æ —â–æ—Å—å –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å,–Ω–µ –∑–∞—Å–º—É—á—É–π—Å—è.</li>
            <li>–ü–æ–º–∏–ª–∫–∏ —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ,–≥–æ–ª–æ–≤–Ω–µ –ø—Ä–∞–∫—Ç–∏–∫–∞.</li>
          </ul>
        </div>

        
        <div id="analysisPanel" style="margin-top:14px" class="panel">
          <h4>–†–æ–∑–±—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</h4>
          <div id="analysisContent"></div>
        </div>

      </div>
    </div>

    <footer>
      <small>–í—Å—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ. –©–æ–± —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ –º—ñ–∂ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ ‚Äî –¥–æ–¥–∞—Ç–∏ —Å–µ—Ä–≤–µ—Ä/–æ–±–ª—ñ–∫–æ–≤–∫–∏.</small>
    </footer>
  </div>
</div>

<script>

const WORDS = [
  {word:'apple', transcr:'Àà√¶p…ôl', translation:'—è–±–ª—É–∫–æ', example:'I ate a red apple after school.', exampleTrans:'–Ø –∑‚Äô—ó–≤ —á–µ—Ä–≤–æ–Ω–µ —è–±–ª—É–∫–æ –ø—ñ—Å–ª—è —à–∫–æ–ª–∏.', level:'A1'},
  {word:'book', transcr:'b äk', translation:'–∫–Ω–∏–≥–∞', example:'She opened the book and read the first page.', exampleTrans:'–í–æ–Ω–∞ –≤—ñ–¥–∫—Ä–∏–ª–∞ –∫–Ω–∏–≥—É —ñ –ø—Ä–æ—á–∏—Ç–∞–ª–∞ –ø–µ—Ä—à—É —Å—Ç–æ—Ä—ñ–Ω–∫—É.', level:'A1'},
  {word:'school', transcr:'skuÀêl', translation:'—à–∫–æ–ª–∞', example:'He goes to school by bus every day.', exampleTrans:'–í—ñ–Ω —ó–∑–¥–∏—Ç—å –¥–æ —à–∫–æ–ª–∏ –∞–≤—Ç–æ–±—É—Å–æ–º —â–æ–¥–Ω—è.', level:'A1'},
  {word:'friend', transcr:'fr…õnd', translation:'–¥—Ä—É–≥', example:'My friend called me yesterday.', exampleTrans:'–ú—ñ–π –¥—Ä—É–≥ –ø–æ–¥–∑–≤–æ–Ω–∏–≤ –º–µ–Ω—ñ –≤—á–æ—Ä–∞.', level:'A1'},
  {word:'family', transcr:'Ààf√¶m…ôli', translation:'—Å—ñ–º º—è', example:'We visit our family on Sundays.', exampleTrans:'–ú–∏ –≤—ñ–¥–≤—ñ–¥—É—î–º–æ –Ω–∞—à—É —Å—ñ–º º—é –ø–æ –Ω–µ–¥—ñ–ª—è—Ö.', level:'A1'},
  {word:'learn', transcr:'l…úÀêrn', translation:'–≤—á–∏—Ç–∏(—Å—è)', example:'I want to learn new words.', exampleTrans:'–Ø —Ö–æ—á—É –≤–∏–≤—á–∞—Ç–∏ –Ω–æ–≤—ñ —Å–ª–æ–≤–∞.', level:'A1'},
  {word:'study', transcr:'Ààst ådi', translation:'–≤—á–∏—Ç–∏—Å—è, –≤–∏–≤—á–∞—Ç–∏', example:'They study English every evening.', exampleTrans:'–í–æ–Ω–∏ –≤–∏–≤—á–∞—é—Ç—å –∞–Ω–≥–ª—ñ–π—Å—å–∫—É –∫–æ–∂–Ω–æ–≥–æ –≤–µ—á–æ—Ä–∞.', level:'A1'},
  {word:'teacher', transcr:'ÀàtiÀêt É…ôr', translation:'–≤—á–∏—Ç–µ–ª—å', example:'The teacher explained the rule clearly.', exampleTrans:'–í—á–∏—Ç–µ–ª—å —á—ñ—Ç–∫–æ –ø–æ—è—Å–Ω–∏–≤ –ø—Ä–∞–≤–∏–ª–æ.', level:'A1'},
  {word:'home', transcr:'ho äm', translation:'–¥—ñ–º', example:'I am happy to be home.', exampleTrans:'–Ø —Ä–∞–¥–∏–π –±—É—Ç–∏ –≤–¥–æ–º–∞.', level:'A1'},
  {word:'play', transcr:'ple…™', translation:'–≥—Ä–∞—Ç–∏', example:'Children play in the park.', exampleTrans:'–î—ñ—Ç–∏ –≥—Ä–∞—é—Ç—å –≤ –ø–∞—Ä–∫—É.', level:'A1'},
  {word:'happy', transcr:'Ààh√¶pi', translation:'—â–∞—Å–ª–∏–≤–∏–π', example:'She is happy today.', exampleTrans:'–í–æ–Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —â–∞—Å–ª–∏–≤–∞.', level:'A1'},
  {word:'important', transcr:'…™mÀàp…îÀêrt…ônt', translation:'–≤–∞–∂–ª–∏–≤–∏–π', example:'This homework is important.', exampleTrans:'–¶–µ –¥–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∞–∂–ª–∏–≤–µ.', level:'A2'},
  {word:'question', transcr:'Ààkw…õst É…ôn', translation:'–ø–∏—Ç–∞–Ω–Ω—è', example:'Do you have a question?', exampleTrans:'–£ –≤–∞—Å —î –ø–∏—Ç–∞–Ω–Ω—è?', level:'A1'},
  {word:'answer', transcr:'Àà√¶ns…ôr', translation:'–≤—ñ–¥–ø–æ–≤—ñ–¥—å', example:'He knows the answer.', exampleTrans:'–í—ñ–Ω –∑–Ω–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å.', level:'A1'},
  {word:'listen', transcr:'Ààl…™s…ôn', translation:'—Å–ª—É—Ö–∞—Ç–∏', example:'Listen to the teacher carefully.', exampleTrans:'–£–≤–∞–∂–Ω–æ —Å–ª—É—Ö–∞–π—Ç–µ –≤—á–∏—Ç–µ–ª—è.', level:'A1'},
  {word:'speak', transcr:'spiÀêk', translation:'–≥–æ–≤–æ—Ä–∏—Ç–∏', example:'Please speak slowly.', exampleTrans:'–ë—É–¥—å –ª–∞—Å–∫–∞, –≥–æ–≤–æ—Ä—ñ—Ç—å –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ.', level:'A1'},
  {word:'write', transcr:'ra…™t', translation:'–ø–∏—Å–∞—Ç–∏', example:'Write your name here.', exampleTrans:'–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—î —ñ–º º—è —Ç—É—Ç.', level:'A1'},
  {word:'read', transcr:'riÀêd', translation:'—á–∏—Ç–∞—Ç–∏', example:'I like to read books.', exampleTrans:'–ú–µ–Ω—ñ –ø–æ–¥–æ–±–∞—î—Ç—å—Å—è —á–∏—Ç–∞—Ç–∏ –∫–Ω–∏–≥–∏.', level:'A1'},
  {word:'help', transcr:'h…õlp', translation:'–¥–æ–ø–æ–º–æ–≥–∞/–¥–æ–ø–æ–º–∞–≥–∞—Ç–∏', example:'Can you help me with this task?', exampleTrans:'–ß–∏ –º–æ–∂–µ—à –¥–æ–ø–æ–º–æ–≥—Ç–∏ –º–µ–Ω—ñ –∑ —Ü–∏–º –∑–∞–≤–¥–∞–Ω–Ω—è–º?', level:'A1'},
  {word:'idea', transcr:'a…™Ààd…™…ô', translation:'—ñ–¥–µ—è', example:'I have a good idea for a project.', exampleTrans:'–£ –º–µ–Ω–µ —î —Ö–æ—Ä–æ—à–∞ —ñ–¥–µ—è –¥–ª—è –ø—Ä–æ—î–∫—Ç—É.', level:'A2'},
  {word:'change', transcr:'t Ée…™nd í', translation:'–∑–º—ñ–Ω–∞/–∑–º—ñ–Ω—é–≤–∞—Ç–∏', example:'People change their minds sometimes.', exampleTrans:'–õ—é–¥–∏ —ñ–Ω–æ–¥—ñ –∑–º—ñ–Ω—é—é—Ç—å –¥—É–º–∫—É.', level:'A2'},
  {word:'travel', transcr:'Ààtr√¶v…ôl', translation:'–ø–æ–¥–æ—Ä–æ–∂—É–≤–∞—Ç–∏', example:'They want to travel next summer.', exampleTrans:'–í–æ–Ω–∏ —Ö–æ—á—É—Ç—å –ø–æ–¥–æ—Ä–æ–∂—É–≤–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –ª—ñ—Ç–∞.', level:'A2'},
  {word:'music', transcr:'ÀàmjuÀêz…™k', translation:'–º—É–∑–∏–∫–∞', example:'Music makes me calm.', exampleTrans:'–ú—É–∑–∏–∫–∞ –∑–∞—Å–ø–æ–∫–æ—é—î –º–µ–Ω–µ.', level:'A1'},
  {word:'movie', transcr:'ÀàmuÀêvi', translation:'—Ñ—ñ–ª—å–º', example:'We watched a funny movie.', exampleTrans:'–ú–∏ –ø–æ–¥–∏–≤–∏–ª–∏—Å—è —Å–º—ñ—à–Ω–∏–π —Ñ—ñ–ª—å–º.', level:'A1'},
  {word:'city', transcr:'Ààs…™ti', translation:'–º—ñ—Å—Ç–æ', example:'The city is very busy.', exampleTrans:'–ú—ñ—Å—Ç–æ –¥—É–∂–µ –∂–≤–∞–≤–µ.', level:'A1'},
  {word:'country', transcr:'Ààk åntri', translation:'–∫—Ä–∞—ó–Ω–∞', example:'Ukraine is a beautiful country.', exampleTrans:'–£–∫—Ä–∞—ó–Ω–∞ ‚Äî –∫—Ä–∞—Å–∏–≤–∞ –∫—Ä–∞—ó–Ω–∞.', level:'A1'},
  {word:'weather', transcr:'Ààw…õ√∞…ôr', translation:'–ø–æ–≥–æ–¥–∞', example:'The weather is sunny today.', exampleTrans:'–ü–æ–≥–æ–¥–∞ —Å—å–æ–≥–æ–¥–Ω—ñ —Å–æ–Ω—è—á–Ω–∞.', level:'A1'},
  {word:'breakfast', transcr:'Ààbr…õkf…ôst', translation:'—Å–Ω—ñ–¥–∞–Ω–æ–∫', example:'I had toast for breakfast.', exampleTrans:'–Ø —ó–≤ —Ç–æ—Å—Ç –Ω–∞ —Å–Ω—ñ–¥–∞–Ω–æ–∫.', level:'A1'},
  {word:'sleep', transcr:'sliÀêp', translation:'—Å–ø–∞—Ç–∏', example:'You should sleep early tonight.', exampleTrans:'–¢–æ–±—ñ —Å–ª—ñ–¥ —Å—å–æ–≥–æ–¥–Ω—ñ –ª—è–≥—Ç–∏ —Ä–∞–Ω—ñ—à–µ —Å–ø–∞—Ç–∏.', level:'A1'}
];


function levenshtein(a, b) {
  if (!a) return b ? b.length : 0;
  if (!b) return a.length;
  a = a.toLowerCase(); b = b.toLowerCase();
  const m = a.length, n = b.length;
  const dp = Array.from({length:m+1},()=>new Array(n+1).fill(0));
  for (let i=0;i<=m;i++) dp[i][0]=i;
  for (let j=0;j<=n;j++) dp[0][j]=j;
  for (let i=1;i<=m;i++){
    for (let j=1;j<=n;j++){
      const cost = a[i-1]===b[j-1]?0:1;
      dp[i][j]=Math.min(dp[i-1][j]+1, dp[i][j-1]+1, dp[i-1][j-1]+cost);
    }
  }
  return dp[m][n];
}
function fuzzyMatch(a,b,threshold=0.7){
  if (!a || !b) return false;
  const d = levenshtein(a.trim(), b.trim());
  if (d === 0) return true;
  const len = Math.max(a.trim().length, b.trim().length);
  const ratio = 1 - d/len;
  return ratio >= threshold;
}


const wordText = document.getElementById('wordText');
const wordTranscr = document.getElementById('wordTranscr');
const wordExample = document.getElementById('wordExample');
const wordExampleTrans = document.getElementById('wordExampleTrans');
const wordTranslation = document.getElementById('wordTranslation');
const speakBtn = document.getElementById('speakBtn');
const testBtn = document.getElementById('testBtn');
const repeatBtn = document.getElementById('repeatBtn');
const showRepeatsBtn = document.getElementById('showRepeats');
const statsBox = document.getElementById('statsBox');
const testArea = document.getElementById('testArea');
const questionsDiv = document.getElementById('questions');
const submitTest = document.getElementById('submitTest');
const cancelTest = document.getElementById('cancelTest');
const resultArea = document.getElementById('resultArea');
const resetStats = document.getElementById('resetStats');
const repeatsList = document.getElementById('repeatsList');
const showAnalysisBtn = document.getElementById('showAnalysisBtn');
const analysisPanel = document.getElementById('analysisPanel');
const analysisContent = document.getElementById('analysisContent');

let todayWord = null;
let currentTest = null;
let lastAnalysis = [];


const STORAGE_KEY = 'wordaday_mvp_v3';
function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : {tests:0, correct:0, repeats:[]};
  }catch(e){return {tests:0, correct:0, repeats:[]};}
}
function saveState(s){ localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); }
let state = loadState();
function updateStatsUI(){
  const totalAnswers = state.tests * 2;
  const pct = totalAnswers ? Math.round(state.correct / totalAnswers * 100) : 0;
  statsBox.innerHTML = `–¢–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–æ: ${state.tests}<br>% –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π: ${pct}%<br>–°–ª—ñ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è: ${state.repeats.length}`;
  renderRepeats();
}
function renderRepeats(){
  if (!state.repeats.length){ repeatsList.innerHTML = '<div class="muted" style="margin-top:12px">–ù–µ–º–∞—î —Å–ª—ñ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</div>'; return; }
  repeatsList.innerHTML = '<div class="muted" style="margin-top:12px">–°–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è:</div>';
  const list = document.createElement('div');
  list.style.marginTop = '8px';
  state.repeats.forEach(w=>{
    const el = document.createElement('div');
    el.textContent = w;
    el.style.padding = '6px 8px';
    el.style.border = '1px solid #eef6ff';
    el.style.borderRadius = '8px';
    el.style.marginTop = '6px';
    list.appendChild(el);
  });
  repeatsList.appendChild(list);
}


function pickWordOfDay(){
  const d = new Date();
  const idx = (d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate()) % WORDS.length;
  return WORDS[idx];
}
function showWord(wordObj){
  todayWord = wordObj;
  wordText.textContent = wordObj.word;
  wordTranscr.textContent = wordObj.transcr ? ('/' + wordObj.transcr + '/') : '';
  wordExample.textContent = wordObj.example;
  wordExampleTrans.textContent = wordObj.exampleTrans ? ('–ü–µ—Ä–µ–∫–ª–∞–¥ –ø—Ä–∏–∫–ª–∞–¥—É: ' + wordObj.exampleTrans) : '';
  wordTranslation.textContent = '–ü–µ—Ä–µ–∫–ª–∞–¥ —Å–ª–æ–≤–∞: ' + wordObj.translation;
}
speakBtn.addEventListener('click', ()=>{
  if (!todayWord) return;
  const ut = new SpeechSynthesisUtterance(todayWord.word);
  ut.lang = 'en-US';
  try { window.speechSynthesis.cancel(); } catch(e){}
  window.speechSynthesis.speak(ut);
});


function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }
function generateTest(n=2){
  const words = shuffle(WORDS);
  const chosen = words.slice(0, n);
  const q0 = {kind:'translate', word:chosen[0], prompt:`–ü–µ—Ä–µ–∫–ª–∞–¥—ñ—Ç—å —Å–ª–æ–≤–æ "${chosen[0].word}" —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é:`};
  const choices = shuffle([chosen[1].translation, ...shuffle(WORDS).slice(0,3).map(x=>x.translation)]);
  const q1 = {kind:'mcq', word:chosen[1], prompt:`–í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —Å–ª–æ–≤–∞ "${chosen[1].word}":`, choices};
  return [q0, q1];
}


testBtn.addEventListener('click', ()=>startTest());
function startTest(){
  currentTest = generateTest(2);
  questionsDiv.innerHTML = '';
  analysisPanel.style.display = 'none';
  showAnalysisBtn.style.display = 'none';
  lastAnalysis = [];
  currentTest.forEach((q, idx)=>{
    const div = document.createElement('div'); div.className='question';
    const label = document.createElement('div'); label.innerHTML = `<strong>–ü–∏—Ç–∞–Ω–Ω—è ${idx+1}:</strong> <span class="muted">${q.prompt}</span>`;
    div.appendChild(label);
    if (q.kind==='translate'){
      const inp = document.createElement('input'); inp.type='text'; inp.id = 'ans_'+idx;
      inp.placeholder = '–í–≤–µ–¥—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å';
      div.appendChild(inp);
    } else if (q.kind==='mcq'){
      q.choices.forEach((c,ci)=>{
        const rb = document.createElement('div'); rb.className='opt';
        rb.innerHTML = `<label><input type="radio" name="q${idx}" value="${c}"> ${c}</label>`;
        div.appendChild(rb);
      });
    }
    questionsDiv.appendChild(div);
  });
  testArea.style.display='block';
  resultArea.innerHTML='';
  window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
}

cancelTest.addEventListener('click', ()=>{ testArea.style.display='none'; currentTest=null; });


submitTest.addEventListener('click', ()=>{
  if (!currentTest) return;
  let correctCount = 0;
  const feedback = document.createElement('div');
  feedback.className = 'feedback';
  lastAnalysis = [];
  currentTest.forEach((q, idx)=>{
    let userAns = '';
    let ok = false;
    let errorType = null;
    let detailed = '';
    if (q.kind==='translate'){
      const inp = document.getElementById('ans_'+idx);
      userAns = inp ? inp.value.trim() : '';
      if (!userAns){
        errorType = '–ü–æ—Ä–æ–∂–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å';
        detailed = '–í–∏ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–≤–µ–ª–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —É–≤–∞–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ —Å–ª–æ–≤–æ —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥ —ñ –¥–∞—Ç–∏ –ø–µ—Ä–µ–∫–ª–∞–¥.';
        ok = false;
      } else if (fuzzyMatch(userAns, q.word.word)){
        errorType = '–í–≤–µ–¥–µ–Ω–æ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ –∑–∞–º—ñ—Å—Ç—å –ø–µ—Ä–µ–∫–ª–∞–¥—É';
        detailed = `–í–∏ –≤–≤–µ–ª–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫–µ —Å–ª–æ–≤–æ "${userAns}". –ü–æ—Ç—Ä—ñ–±–µ–Ω –ø–µ—Ä–µ–∫–ª–∞–¥ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é ‚Äî –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: "${q.word.translation}".`;
        ok = false;
      } else if (fuzzyMatch(userAns, q.word.translation, 0.6)){
        errorType = '–û—Ä—Ñ–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ (–ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥)';
        detailed = `–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –±–ª–∏–∑—å–∫–∞ –¥–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª–∞–¥—É "${q.word.translation}". –ú–æ–∂–ª–∏–≤–æ, —î –æ–¥–Ω–∞-–¥–≤—ñ –ª—ñ—Ç–µ—Ä–∏ –Ω–µ –Ω–∞ –º—ñ—Å—Ü—ñ.`;
        ok = true;
      } else {
        ok = fuzzyMatch(userAns, q.word.translation);
        if (!ok){
          if (/s$/.test(userAns.toLowerCase()) && !q.word.translation.toLowerCase().endsWith('s')){
            errorType = '–ú–æ–∂–ª–∏–≤–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞ (–º–Ω–æ–∂–∏–Ω–∞)';
            detailed = `–í–∏ –º–æ–≥–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –º–Ω–æ–∂–∏–Ω—É –∞–±–æ —ñ–Ω—à—É —Ñ–æ—Ä–º—É. –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥: "${q.word.translation}".`;
          } else {
            errorType = '–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥';
            detailed = `–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å "${userAns}" –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–Ω–∞—á–µ–Ω–Ω—é —Å–ª–æ–≤–∞ –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ ("${q.word.example}"). –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: "${q.word.translation}".`;
          }
        } else {
          detailed = `–í—ñ–¥–ø–æ–≤—ñ–¥—å —Ç–æ—á–Ω–∞: "${q.word.translation}". –î–æ–±—Ä–µ!`;
        }
      }
    } else if (q.kind==='mcq'){
      const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
      userAns = chosen ? chosen.value : '';
      if (!userAns){ errorType = '–ù—ñ—á–æ–≥–æ –Ω–µ –≤–∏–±—Ä–∞–Ω–æ'; detailed = '–í–∏ –Ω–µ –æ–±—Ä–∞–ª–∏ –≤–∞—Ä—ñ–∞–Ω—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.'; ok = false; }
      else {
        ok = userAns.toLowerCase().trim() === q.word.translation.toLowerCase().trim();
        if (!ok){ errorType = '–û–±—Ä–∞–Ω–æ –Ω–µ–≤—ñ—Ä–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å'; detailed = `–í–∏ –≤–∏–±—Ä–∞–ª–∏ "${userAns}". –ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: "${q.word.translation}".`; }
        else { detailed = `–í–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–±—Ä–∞–ª–∏ "${q.word.translation}".`; }
      }
    }

    const fb = document.createElement('div'); fb.style.marginTop='8px';
    if (ok){
      fb.innerHTML = `<div class="correct">–ü–∏—Ç–∞–Ω–Ω—è ${idx+1}: –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚úÖ</div>`;
      correctCount++;
    } else {
      fb.innerHTML = `<div class="wrong">–ü–∏—Ç–∞–Ω–Ω—è ${idx+1}: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚ùå</div>`;
      fb.innerHTML += `<div class="hint"><strong>–¢–∏–ø –ø–æ–º–∏–ª–∫–∏:</strong> ${errorType || '–ù–µ–≤—ñ–¥–æ–º–æ'}</div>`;
      fb.innerHTML += `<div class="hint">${detailed}</div>`;
      if (!state.repeats.includes(q.word.word)) state.repeats.push(q.word.word);
      if (q.kind==='translate'){
        const inp = document.getElementById('ans_'+idx);
        if (inp) inp.classList.add('highlight-wrong');
      } else if (q.kind==='mcq'){
        const chosen = document.querySelector(`input[name="q${idx}"]:checked`);
        if (chosen) chosen.parentElement.classList.add('highlight-wrong');
        const radios = document.querySelectorAll(`input[name="q${idx}"]`);
        radios.forEach(r=>{
          if (r.value.toLowerCase().trim() === q.word.translation.toLowerCase().trim()){
            r.parentElement.classList.add('highlight-correct');
          }
        });
      }
    }
    feedback.appendChild(fb);
    lastAnalysis.push({
      question: q.prompt,
      userAnswer: userAns || '(–Ω–µ–º–∞—î)',
      correctAnswer: q.word.translation,
      errorType: errorType || (ok ? '–ü—Ä–∞–≤–∏–ª—å–Ω–æ' : '–ù–µ–≤—ñ—Ä–Ω–æ'),
      detail: detailed
    });
  });

  state.tests += 1;
  state.correct += correctCount;
  saveState(state);
  updateStatsUI();

  resultArea.innerHTML = `<div class="result-line">–†–µ–∑—É–ª—å—Ç–∞—Ç: ${correctCount} / ${currentTest.length}</div>`;
  resultArea.appendChild(feedback);

  if (lastAnalysis.length){
    buildAnalysisContent();
    showAnalysisBtn.style.display = 'inline-block';
  } else {
    showAnalysisBtn.style.display = 'none';
  }
  
  analysisPanel.style.display = 'none';
  showAnalysisBtn.onclick = ()=>{ analysisPanel.style.display = 'block'; analysisPanel.scrollIntoView({behavior:'smooth', block:'center'}); };
  currentTest=null;
  testArea.style.display='none';
});


function buildAnalysisContent(){
  analysisContent.innerHTML = '';
  lastAnalysis.forEach((a, i)=>{
    const wrap = document.createElement('div');
    wrap.style.marginBottom = '10px';
    wrap.innerHTML = `<strong>–ü–∏—Ç–∞–Ω–Ω—è ${i+1}:</strong> <div class="muted">${a.question}</div>
      <div style="margin-top:6px"><strong>–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> ${a.userAnswer}</div>
      <div style="margin-top:4px"><strong>–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> ${a.correctAnswer}</div>
      <div style="margin-top:6px;color:${a.errorType==='–ü—Ä–∞–≤–∏–ª—å–Ω–æ' ? 'var(--good)' : 'var(--bad)'}"><strong>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</strong> ${a.errorType}</div>
      <div style="margin-top:6px" class="muted"><strong>–ü–æ—è—Å–Ω–µ–Ω–Ω—è:</strong> ${a.detail}</div>`;
    analysisContent.appendChild(wrap);
  });
}


repeatBtn.addEventListener('click', ()=>{
  if (!todayWord) return;
  if (!state.repeats.includes(todayWord.word)) state.repeats.push(todayWord.word);
  saveState(state); updateStatsUI();
});
showRepeatsBtn.addEventListener('click', ()=>{ renderRepeats(); alert('–°–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –ø–æ–∫–∞–∑–∞–Ω—ñ –≤ –±—ñ—á–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ.'); });
resetStats.addEventListener('click', ()=>{
  if (confirm('–°–∫–∏–Ω—É—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
    state = {tests:0, correct:0, repeats:[]};
    saveState(state); updateStatsUI();
    alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–∏—â–µ–Ω–∞.');
  }
});


showWord(pickWordOfDay());
updateStatsUI();
</script>
</body>
</html>
